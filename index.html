<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Radio Gardening Summer School</title>
    <link rel="stylesheet" href="styles.css">
    <link href="https://fonts.googleapis.com/css2?family=IBM+Plex+Mono:ital@0;1&amp;display=swap" rel="stylesheet">
    <!--  How to make a website for radio that is site- and time-specific?

    Isn’t it strange how you tune into an internet radio stream by clicking play, as if you start the broadcast rather than join in on something that is already happening? Instead of showing the playtime of the individual user, can we emphasise the place in time within the entire broadcast?

    How can we bring a remote audience into a site-specific, ongoing broadcast that portrays the passage of time as well as the activity and life of that space? Can we create an online space for a collective experience?  -->
</head>
<body>
    <div class="site-container">
        <header class="header">
            <div class="header__title">
                <a href="" class="site-title">Radio<br>Gardening<br>Summer School</a>
            </div>
            <div>
                <nav class="header__nav">
                    <button class="chat__toggleBtn button">Join the chat</button>
                    <button class="schedule__toggleBtn button">Check the schedule</button>
                    <a href="https://robidacollective.com/projects/academy-of-margins/summer-school-of-the-academy-of-margins-2025" class="button" target="_blank">More info</a>
                </nav>
            </div>
        </header>
        <main class="main">
            <section class="section">
                <div class="stream">
                    <div class="stream__channel" id="one">
                        <div class="stream__background"></div>
                        <div class="audio">
                            <audio class="audio__source" src="https://radio.goodtimesbadtimes.club/radio/8030/radio.mp3"></audio>
                            <div class="audio__ui">
                                <button class="button audio__playBtn">Listen in</button>
                            </div>
                        </div>
                        <p class="stream__name">Ambient Topolò</p>
                    </div>
                    <div class="stream__channel stream__channel--mid" id="two">
                        <div class="stream__background"></div>
                        <div class="audio">
                            <audio class="audio__source" src="https://radio.goodtimesbadtimes.club/radio/8060/radio.mp3"></audio>
                            <div class="audio__ui">
                                <button class="button audio__playBtn">Listen in</button>
                            </div>
                        </div>
                        <p class="stream__name">TBC</p>
                    </div>
                    <div class="stream__channel" id="three">
                        <div class="stream__background"></div>
                        <div class="audio">
                            <audio class="audio__source" src="https://radio.goodtimesbadtimes.club/radio/8010/radio.mp3"></audio>
                            <div class="audio__ui">
                                <button class="button audio__playBtn">Listen in</button>
                            </div>
                        </div>
                        <p class="stream__name">Walkie-Talkie</p>
                    </div>
                </div>
        </main>
        <aside>
            <section>
                <div id="schedule" class="draggable schedule hidden">
                    <button class="button schedule__toggleBtn draggable__toggleBtn">&times;</button>
                    <ul id="scheduleList" class="schedule__list draggable__content"></ul>
                </div>
            </section>
            <section>
                <div id="chat" class="chat draggable hidden">
                    <button class="button chat__toggleBtn draggable__toggleBtn">&times;</button>
                    <div class="chat__embed draggable__content">
                        <script id="cid0020000246831166936" data-cfasync="false" async src="https://st.chatango.com/js/gz/emb.js" style="width: 100%;height: 100%;">{"handle":"radiorobida","arch":"js","styles":{"a":"E6E6E6","b":100,"c":"000000","d":"000000","k":"E6E6E6","l":"E6E6E6","m":"E6E6E6","p":"10","q":"E6E6E6","r":100,"allowpm":0,"cnrs":"0.35","fwtickm":1,"showx":0,"surl":0,"fwtickm":0}}</script>
                    </div>
                </div>
            </section>
        </aside>
        <footer class="footer">
            <div class="timeline-wrapper">
                <button id="toggleViewBtn" class="button">+/-</button>
                <div id="timeline" class="timeline timeline--week">
                <div class="timeline__track"></div>
                </div>
            </div>
            <div class="announcements">
                <marquee scrollamount="3" class="announcements__marquee">
                    <span>Announcements....</span>
                </marquee>
            </div>
    
        </footer>
    </div>

</body>

<!-- TELEGRAM SCRIPTS -->

<script>

// IMAGES
  async function loadChannelImages() {
  try {
    const response = await fetch('telegram/telegram_data/channel_images.json', { cache: 'no-store' });
    if (!response.ok) {
      console.error('❌ Failed to load channel_images.json');
      return;
    }

    const images = await response.json();

    Object.entries(images).forEach(([id, imagePath]) => {
      const channelDiv = document.getElementById(id);
      if (channelDiv) {
        const bgDiv = channelDiv.querySelector('.stream__background');
        if (bgDiv) {
          bgDiv.style.backgroundImage = `url('${imagePath}')`;
          bgDiv.style.backgroundSize = 'cover';
          bgDiv.style.backgroundPosition = 'center';
          bgDiv.style.backgroundRepeat = 'no-repeat';
        } else {
          console.warn(`⚠️ No .stream__background found inside #${id}`);
        }
      } else {
        console.warn(`⚠️ No div found with id "${id}"`);
      }
    });
  } catch (err) {
    console.error('❌ Error loading or applying channel images:', err);
  }
}

document.addEventListener('DOMContentLoaded', loadChannelImages);


// ANNOUNCEMENTS

function formatCEST(dateString) {
    // Parse "YYYY-MM-DD HH:mm"
    const [datePart, timePart] = dateString.split(' ');
    const [year, month, day] = datePart.split('-').map(Number);
    const [hour, minute] = timePart.split(':').map(Number);

    // Create UTC date and shift to CEST (UTC+2)
    const utcMillis = Date.UTC(year, month - 1, day, hour - 2, minute);
    const date = new Date(utcMillis);

    // Always format in CEST
    const options = {
        timeZone: 'Europe/Berlin', // CEST/CET
        hour: '2-digit',
        minute: '2-digit',
        day: '2-digit',
        month: 'short'
    };

    return date.toLocaleString('en-GB', options).replace(',', '');
}

async function loadAnnouncements() {
    try {
        const response = await fetch('telegram/telegram_data/announcements.json', {
            cache: 'no-store'
        });

        if (!response.ok) {
            console.error("Failed to load announcements.json");
            return;
        }

        const announcements = await response.json();

        if (!Array.isArray(announcements) || announcements.length === 0) {
            console.log("No announcements found");
            return;
        }

        const latestThree = announcements
            .sort((a, b) => new Date(b.date) - new Date(a.date))
            .slice(0, 3);

        const marqueeText = latestThree
            .map(a => `[${formatCEST(a.date)} CEST] ${a.text}`)
            .join(' 🟢 ');

        const marquee = document.querySelector('.announcements__marquee span');
        if (marquee) {
            marquee.textContent = marqueeText;
        }
    } catch (err) {
        console.error("Error loading announcements:", err);
    }
}

document.addEventListener('DOMContentLoaded', loadAnnouncements);
</script>




<script src="script.js"></script>
<script src="timeline.js"></script>
</html>